# easy-translate 快速开发指南

## 📋 目录

- [开发环境搭建](#开发环境搭建)
- [项目结构说明](#项目结构说明)
- [本地开发流程](#本地开发流程)
- [代码规范](#代码规范)
- [测试指南](#测试指南)
- [调试方法](#调试方法)
- [提交规范](#提交规范)
- [常见问题](#常见问题)

---

## 🛠️ 开发环境搭建

### 环境要求

- **Node.js**: >= 14.0.0
- **npm**: >= 6.0.0
- **浏览器**: Edge 88+ 或 Chrome 88+
- **编辑器**: VS Code (推荐)

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/username/easy_translate.git
cd easy_translate
```

2. **安装依赖**
```bash
npm install
```

3. **验证安装**
```bash
npm run dev
```

### 开发工具推荐

- **VS Code 插件**:
  - ESLint
  - Prettier
  - Chrome Debugger
  - Auto Rename Tag

---

## 📁 项目结构说明

```
easy-translate/
├── src/                    # 源代码目录
│   ├── content/           # Content Script (注入到网页)
│   ├── background/        # Background Script (后台脚本)
│   ├── popup/             # 插件弹窗界面
│   ├── utils/             # 工具函数
│   ├── config/            # 配置文件
│   └── icons/             # 插件图标
├── test/                  # 测试代码
│   ├── unit/             # 单元测试
│   ├── integration/      # 集成测试
│   └── e2e/              # 端到端测试
├── docs/                  # 项目文档
├── dist/                  # 构建输出
└── scripts/               # 构建脚本
```

### 核心文件说明

- **manifest.json**: 插件配置文件
- **webpack.config.js**: 构建配置
- **package.json**: 项目依赖和脚本

---

## 🚀 本地开发流程

### 1. 启动开发模式

```bash
npm run dev
```

开发模式会：
- 启动文件监听
- 自动重新构建
- 输出到 `dist/` 目录

### 2. 加载插件到浏览器

1. 打开 `edge://extensions/`
2. 开启"开发人员模式"
3. 点击"加载解压缩的扩展"
4. 选择项目根目录

### 3. 开发调试

- **Content Script**: 在网页中调试
- **Background Script**: 在扩展管理页面调试
- **Popup**: 右键插件图标选择"检查弹出内容"

### 4. 构建生产版本

```bash
npm run build
```

---

## 📝 代码规范

### JavaScript 规范

- 使用 ES6+ 语法
- 使用 `const` 和 `let`，避免 `var`
- 使用箭头函数
- 使用模板字符串
- 使用解构赋值

```javascript
// ✅ 推荐
const { name, age } = user;
const greeting = `Hello, ${name}!`;
const handleClick = () => { /* ... */ };

// ❌ 避免
var name = user.name;
var greeting = "Hello, " + name + "!";
function handleClick() { /* ... */ }
```

### CSS 规范

- 使用 BEM 命名规范
- 使用 CSS 变量
- 避免内联样式

```css
/* ✅ 推荐 */
.easy-translate__button {
  --primary-color: #007acc;
  background-color: var(--primary-color);
}

/* ❌ 避免 */
.button {
  background-color: #007acc;
}
```

### HTML 规范

- 使用语义化标签
- 添加适当的 ARIA 属性
- 保持结构清晰

```html
<!-- ✅ 推荐 -->
<button class="easy-translate__download" aria-label="下载文件">
  下载
</button>

<!-- ❌ 避免 -->
<div class="btn" onclick="download()">下载</div>
```

---

## 🧪 测试指南

### 单元测试

```bash
# 运行单元测试
npm test

# 运行测试并生成覆盖率报告
npm run test:coverage
```

### 集成测试

```bash
# 运行集成测试
npm run test:integration
```

### 端到端测试

```bash
# 运行 E2E 测试
npm run test:e2e
```

### 测试文件结构

```
test/
├── unit/                 # 单元测试
│   ├── utils.test.js    # 工具函数测试
│   └── config.test.js   # 配置测试
├── integration/          # 集成测试
│   └── api.test.js      # API 测试
└── e2e/                 # 端到端测试
    └── download.test.js # 下载功能测试
```

---

## 🐛 调试方法

### 1. Content Script 调试

1. 在网页中右键 → "检查"
2. 切换到 Console 标签
3. 查看插件输出的日志

### 2. Background Script 调试

1. 打开 `edge://extensions/`
2. 找到插件，点击"详情"
3. 点击"检查视图：背景页"

### 3. Popup 调试

1. 右键插件图标
2. 选择"检查弹出内容"

### 4. 常见调试技巧

```javascript
// 添加调试日志
console.log('Debug:', data);

// 使用断点
debugger;

// 检查插件状态
chrome.storage.local.get(null, console.log);
```

---

## 📤 提交规范

### 提交信息格式

```
<type>(<scope>): <subject>

<body>

<footer>
```

### 类型说明

- **feat**: 新功能
- **fix**: 修复bug
- **docs**: 文档更新
- **style**: 代码格式调整
- **refactor**: 代码重构
- **test**: 测试相关
- **chore**: 构建过程或辅助工具的变动

### 示例

```bash
# 新功能
git commit -m "feat(download): 添加批量下载功能"

# 修复bug
git commit -m "fix(ui): 修复弹窗显示异常"

# 文档更新
git commit -m "docs(readme): 更新安装说明"
```

### 提交前检查

```bash
# 运行测试
npm test

# 检查代码格式
npm run lint

# 构建检查
npm run build
```

---

## ❓ 常见问题

### Q: 插件无法加载？

**A**: 检查以下几点：
1. 确认 `manifest.json` 格式正确
2. 检查浏览器版本是否支持
3. 查看浏览器控制台错误信息

### Q: Content Script 不生效？

**A**: 可能的原因：
1. 检查 `manifest.json` 中的 `content_scripts` 配置
2. 确认目标网站没有被排除
3. 检查脚本是否有语法错误

### Q: 构建失败？

**A**: 常见解决方案：
1. 删除 `node_modules` 重新安装
2. 检查 Node.js 版本
3. 查看 webpack 配置

### Q: 调试时看不到日志？

**A**: 检查方法：
1. 确认在正确的控制台中查看
2. 检查日志级别设置
3. 确认插件已重新加载

---

## 📚 相关资源

- [Chrome Extension API](https://developer.chrome.com/docs/extensions/)
- [Edge Extension API](https://docs.microsoft.com/en-us/microsoft-edge/extensions-chromium/)
- [Webpack 文档](https://webpack.js.org/)
- [Jest 测试框架](https://jestjs.io/)

---

**文档版本**: v1.0  
**最后更新**: 2024-12-19  
**维护人员**: 开发团队 