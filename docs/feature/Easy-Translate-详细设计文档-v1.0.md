# Easy Translate-详细设计文档-v1.0

## 1. 概述

### 需求理解
- **核心功能**:
  - 浏览器插件自动检测网页下载链接，提供一键传输到服务器的能力
  - 本地Python服务作为桥梁，负责文件下载、传输、状态反馈
  - 支持多协议（SFTP为MVP，后续支持FTP/SCP）
  - 服务器配置加密管理，传输进度与历史可查
- **业务价值**:
  - 极大简化"网页文件→服务器"流程，提升效率70%以上
  - 降低用户操作门槛，提升满意度
  - 保证传输安全、可控、可追溯
- **功能范围**:
  - 系统内：插件端链接检测、交互、本地下载；本地服务端请求处理、文件传输、配置管理、进度反馈、历史记录
  - 系统外：目标服务器、浏览器核心、操作系统文件系统、网络
  - 约束：插件无法直接访问本地文件系统，需本地服务桥接；传输文件最大2GB；并发最多3个；仅支持主流协议和文件类型
- **非功能需求**:
  - 性能：响应<2秒，传输>10MB/s，启动≤10秒
  - 安全：配置AES-256加密，传输过程加密，临时文件及时清理
  - 兼容性：Win10+/macOS 10.15+/Linux，Python 3.7+，主流浏览器
  - 可用性：系统可用性>99%，传输成功率>95%，操作≤3步

### 技术约束
- **现有架构**:
  - 前端：浏览器插件（Chrome/Edge等）
  - 后端：本地Python HTTP服务，RESTful API
  - 服务器端：SFTP/FTP/SCP协议
- **兼容性要求**:
  - 插件与本地服务HTTP通信
  - 本地服务需支持多平台（Win/macOS/Linux）
  - 服务器需支持标准文件传输协议
- **技术限制**:
  - 插件无法直接操作本地文件系统
  - 需用户本地安装Python环境
  - 网络环境需稳定

### 架构调研
- **技术栈评估**:
  - 插件端：可用JS/TS，标准浏览器扩展API
  - 本地服务：Python（Flask/FastAPI等），丰富的文件/协议库
  - 传输协议：paramiko（SFTP）、ftplib（FTP）、scp等Python库成熟
- **组件复用性**:
  - 可复用现有HTTP服务、文件传输、加密存储等Python库
  - 插件端可复用标准UI组件、右键菜单API
- **扩展性分析**:
  - 后续可扩展多协议、批量传输、断点续传、高级配置等
  - 插件和本地服务解耦，便于独立升级

### 风险评估
- **技术风险**:
  - 浏览器安全策略限制，插件与本地服务通信需用户授权
  - 跨平台兼容性（不同OS文件路径、权限差异）
  - 大文件/不稳定网络下的传输中断处理
- **时间风险**:
  - 多平台测试和适配需额外时间
  - 协议兼容性和安全加密实现需充分验证
- **资源风险**:
  - 需2-3人团队，4周内完成MVP
  - 需充分测试环境，覆盖主流平台和协议

---

## 2. 功能设计

### 模块划分
- **核心模块**:
  1. 本地服务启动模块
  2. 链接检测与用户界面模块（插件端）
  3. 文件下载模块
  4. 传输请求处理模块
  5. 文件传输执行模块
  6. 服务器配置管理模块
  7. 传输监控模块
  8. 历史记录模块
- **支撑模块**:
  - 配置加密与解密工具
  - 日志与错误处理工具
  - 临时文件管理工具
- **集成模块**:
  - 插件与本地服务的RESTful API接口
  - 本地服务与目标服务器的协议适配层

### 业务流程
- 用户访问网页，插件自动检测下载链接，显示"传输到服务器"按钮。
- 用户点击按钮，插件校验本地服务是否启动，未启动则自动唤起。
- 插件向本地服务发起传输请求（含文件URL、目标服务器等参数）。
- 本地服务下载文件到临时目录，校验完整性。
- 本地服务根据配置选择协议（MVP为SFTP），连接目标服务器并传输文件。
- 传输进度和状态实时反馈给插件端，最终结果通知用户。
- 传输历史记录自动保存，支持查询和清理。

### 用户交互
- 链接旁悬浮按钮、右键菜单"传输到服务器"
- 服务器配置弹窗（添加/编辑/删除）
- 传输进度弹窗/通知
- 历史记录页面

---

## 3. 系统设计

### 整体架构
- 前端：浏览器插件（负责链接检测、用户交互、请求本地服务）
- 后端：本地Python HTTP服务（负责文件下载、传输、配置管理、进度反馈、历史记录）
- 目标服务器：支持SFTP（MVP），后续可扩展FTP/SCP

### 组件关系
- 插件通过RESTful API与本地服务通信
- 本地服务通过SFTP/FTP/SCP协议与目标服务器通信
- 插件与本地服务解耦，便于独立升级和维护

### 技术选型
- 插件端：JavaScript/TypeScript，标准浏览器扩展API
- 本地服务：Python 3.7+，Flask或FastAPI，paramiko（SFTP），cryptography（加密），json（本地存储）

### API接口
- GET /health
- POST /transfer
- GET /progress/{task_id}
- GET /servers
- POST /servers
- PUT /servers/{id}
- DELETE /servers/{id}
- GET /history
- DELETE /history/{id}

### 数据模型
- 服务器配置、传输任务、历史记录（详见数据设计）

### 安全设计
- 本地服务仅监听127.0.0.1
- 插件与本地服务间可采用token或随机端口防止CSRF
- 服务器配置AES-256加密存储
- 文件传输过程采用SFTP/SCP等加密协议
- 临时文件传输完成后立即删除
- 严格参数校验，日志脱敏

---

## 4. 实现方案

### 实现策略
- 插件端与本地服务端解耦开发，接口联调
- MVP优先实现SFTP协议，接口和架构预留多协议扩展
- 采用模块化开发，便于后续功能增强和维护

### 技术路线
- 插件端：基于Chrome/Edge扩展API，JS/TS实现链接检测、UI交互、API请求
- 本地服务端：Python 3.7+，Flask或FastAPI实现RESTful API，paramiko实现SFTP，cryptography实现配置加密
- 传输流程：插件发起请求→本地服务下载文件→SFTP上传→进度反馈→历史记录
- 配置与历史：本地加密JSON存储，定期清理历史和临时文件

### 关键技术
- 浏览器插件开发（内容脚本、右键菜单、消息通信）
- Python多线程/异步处理并发传输
- SFTP文件传输（paramiko）
- AES-256加密（cryptography）
- 本地API安全（仅监听127.0.0.1、token校验）

### 性能方案
- 插件响应时间<2秒，文件传输速度>10MB/s，并发传输≤3个，系统启动≤10秒
- 本地服务端采用异步/多线程处理传输任务，文件分块传输，进度实时推送（轮询或WebSocket，MVP可用轮询）
- 临时文件及时清理，传输任务队列管理，定期清理过期历史和临时文件

### 质量方案
- 单元测试、集成测试、跨平台测试、协议兼容性测试
- 代码覆盖率≥80%，主要功能自动化测试，性能/安全测试
- 本地服务日志记录关键操作和异常（脱敏），插件端错误上报与用户提示，传输失败自动重试

---

## 5. 数据设计

### 5.1 数据模型
- **服务器配置（加密存储于本地JSON）**
  ```json
  {
    "id": "唯一标识",
    "name": "服务器名称",
    "host": "主机地址",
    "port": "端口号",
    "protocol": "SFTP",
    "username": "用户名",
    "password": "加密密码",
    "default_path": "默认上传路径",
    "created_at": "创建时间",
    "updated_at": "更新时间"
  }
  ```
- **传输任务**
  ```json
  {
    "id": "任务唯一标识",
    "file_path": "本地文件路径",
    "file_name": "文件名",
    "file_size": "文件大小",
    "server_id": "目标服务器ID",
    "target_path": "目标路径",
    "status": "传输状态",
    "progress": "传输进度",
    "started_at": "开始时间",
    "completed_at": "完成时间"
  }
  ```
- **传输历史**
  ```json
  {
    "id": "历史记录ID",
    "task_id": "关联任务ID",
    "file_name": "文件名",
    "server_name": "目标服务器",
    "status": "传输结果",
    "file_size": "文件大小",
    "duration": "传输耗时",
    "created_at": "记录时间"
  }
  ```

### 5.2 存储方案
- 服务器配置、传输任务、历史记录均存储于本地JSON文件（如servers.json、tasks.json、history.json），敏感字段（如密码）使用AES-256加密。
- 临时文件存储于本地临时目录，传输完成后自动删除。

---

## 6. 技术规格
- 插件端：Chrome/Edge扩展，JS/TS，标准API
- 本地服务端：Python 3.7+，Flask/FastAPI，paramiko，cryptography
- 配置/历史存储：本地加密JSON文件
- 传输协议：SFTP（MVP），后续可扩展FTP/SCP
- 兼容性：Win10+/macOS 10.15+/Linux
- API接口：RESTful，详见系统设计

---

## 7. 质量标准
- 代码覆盖率≥80%
- 主要功能自动化测试
- 性能测试：大文件、并发、异常场景
- 安全测试：配置加密、API访问控制
- 传输成功率>95%，系统可用性>99%
- 用户操作≤3步，响应≤2秒

---

## 8. 部署指南
- 安装Python 3.7+，pip安装依赖
- 启动本地服务（如python main.py）
- 插件端安装至浏览器，首次使用自动检测/引导本地服务
- 配置服务器信息，开始文件传输
- 日志与历史记录本地可查，敏感信息加密存储 