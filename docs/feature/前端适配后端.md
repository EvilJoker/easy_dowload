
## 现状分析

### 1. 前端现状
- 你的前端是一个浏览器扩展，主要通过 popup、background、content 脚本实现 UI 和交互。
- 目前前端的“服务器管理”、“任务管理”、“历史记录”等功能，**主要依赖本地存储（chrome.storage.local）**，而不是后端 API。
- 代码结构较大，部分功能实现方式与后端 API 设计不一致。

### 2. 后端现状
- 后端已实现 RESTful API，支持服务器配置、任务队列、历史记录、错误统计等。
- API 路径、数据结构、状态管理都较为规范。

### 3. 适配目标
- 前端所有涉及“服务器、任务、历史、错误”等数据的操作，**都应通过 HTTP 请求与后端交互**，而不是本地存储。
- 前端 UI/UX 逐步与后端数据模型对齐，保证功能和数据一致性。

---

## 分阶段改造计划

### 阶段0：准备与基础
- **梳理前后端数据结构**，明确哪些字段、接口需要适配。
- **封装前端 API 客户端**，统一管理所有与后端的 HTTP 通信（如 axios/fetch 封装）。
- **配置开发环境**，支持本地跨域、后端 API 地址配置。

---

### 阶段1：服务器管理功能适配

**目标**：前端“服务器管理”全部通过后端 API 实现。

- 1.1 封装服务器相关 API（GET /servers, POST /servers, PUT, DELETE）
- 1.2 替换前端所有服务器列表、添加、编辑、删除逻辑为 API 调用
- 1.3 UI 适配后端返回的数据结构
- 1.4 本地存储与后端数据同步（如有必要，先做降级兼容）

---

### 阶段2：任务管理功能适配

**目标**：前端“任务管理”全部通过后端 API 实现。

- 2.1 封装任务相关 API（GET /tasks, GET /tasks/<id>, POST /transfer, POST /tasks/<id>/cancel）
- 2.2 替换前端所有任务列表、进度、取消、重试等逻辑为 API 调用
- 2.3 UI 适配后端任务状态、进度等字段
- 2.4 支持轮询/刷新任务进度（可选：WebSocket 实时推送）

---

### 阶段3：历史记录功能适配

**目标**：前端“历史记录”全部通过后端 API 实现。

- 3.1 封装历史相关 API（GET /history, GET /history/<id>, DELETE /history/<id>）
- 3.2 替换前端所有历史记录展示、删除等逻辑为 API 调用
- 3.3 UI 适配后端历史数据结构

---

### 阶段4：错误与统计信息适配

**目标**：前端“错误统计”、“系统状态”等通过后端 API 实现。

- 4.1 封装错误与统计相关 API（GET /errors, GET /statistics, POST /errors/clear）
- 4.2 替换前端相关展示逻辑为 API 调用
- 4.3 UI 适配后端返回的统计数据

---

### 阶段5：体验与细节优化

- 5.1 统一前端所有 API 错误处理、loading 状态、用户提示
- 5.2 优化前端数据缓存与刷新策略
- 5.3 增加前后端接口联调测试
- 5.4 文档与开发说明同步更新

---

## 每个阶段的建议流程

1. **分析现有前端相关代码**（如服务器管理相关的 JS/HTML 片段）
2. **梳理后端 API 设计与数据结构**
3. **实现 API 封装与替换**
4. **UI 适配与联调**
5. **测试与回归**

---

## 建议的优先级

1. 服务器管理（最基础，其他功能依赖服务器配置）
2. 任务管理（核心业务流程）
3. 历史记录（用户体验提升）
4. 错误与统计（辅助功能）
5. 体验与细节优化（收尾）

---

如需详细到每个阶段的“具体改造点/文件/函数”，可进一步分析前端 popup/background 代码结构，给出更细致的分工和建议。  
你可以指定“先做服务器管理”或“先做任务管理”，我可以帮你详细拆解每一步。
