<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Translate Demo - API & Plugin Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        .demo-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            background: #f8f9fa;
        }
        
        .demo-section h3 {
            color: #495057;
            margin-bottom: 1rem;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 0.5rem;
        }
        
        .test-result {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        
        .test-success {
            background-color: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        
        .test-error {
            background-color: #f8d7da;
            color: #842029;
            border: 1px solid #f5c2c7;
        }
        
        .test-info {
            background-color: #cff4fc;
            color: #055160;
            border: 1px solid #b6effb;
        }
        
        .download-link {
            display: inline-block;
            margin: 0.25rem;
            padding: 0.5rem 1rem;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 0.25rem;
            transition: background-color 0.15s;
        }
        
        .download-link:hover {
            background: #0056b3;
            color: white;
            text-decoration: none;
        }
        
        .plugin-status {
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin: 0.5rem 0;
        }
        
        .plugin-active {
            background-color: #d1e7dd;
            color: #0f5132;
        }
        
        .plugin-inactive {
            background-color: #f8d7da;
            color: #842029;
        }
        
        .server-form {
            background: white;
            padding: 1rem;
            border-radius: 0.25rem;
            border: 1px solid #dee2e6;
        }
        
        .btn-group-vertical .btn {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Easy Translate Demo</h1>
        <p class="text-center text-muted">APIè¿æ¥æµ‹è¯•å’Œæ’ä»¶åŠŸèƒ½æµ‹è¯•</p>
        
        <!-- APIè¿æ¥æµ‹è¯• -->
        <div class="demo-section">
            <h3>ğŸ”Œ APIè¿æ¥æµ‹è¯•</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>åç«¯çŠ¶æ€</h5>
                    <button class="btn btn-primary" onclick="testHealthCheck()">å¥åº·æ£€æŸ¥</button>
                    <button class="btn btn-info" onclick="testGetServers()">è·å–æœåŠ¡å™¨åˆ—è¡¨</button>
                    <button class="btn btn-success" onclick="testCreateServer()">åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨</button>
                    <div id="apiResults"></div>
                </div>
                <div class="col-md-6">
                    <h5>APIå®¢æˆ·ç«¯æµ‹è¯•</h5>
                    <button class="btn btn-warning" onclick="testApiClient()">æµ‹è¯•APIå®¢æˆ·ç«¯</button>
                    <button class="btn btn-secondary" onclick="testDataConversion()">æµ‹è¯•æ•°æ®è½¬æ¢</button>
                    <div id="clientResults"></div>
                </div>
            </div>
        </div>
        
        <!-- æ’ä»¶åŠŸèƒ½æµ‹è¯• -->
        <div class="demo-section">
            <h3>ğŸ”§ æ’ä»¶åŠŸèƒ½æµ‹è¯•</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>æ’ä»¶çŠ¶æ€</h5>
                    <div id="pluginStatus" class="plugin-status plugin-inactive">
                        æ­£åœ¨æ£€æµ‹æ’ä»¶çŠ¶æ€...
                    </div>
                    <button class="btn btn-primary" onclick="checkPluginStatus()">æ£€æŸ¥æ’ä»¶çŠ¶æ€</button>
                    <button class="btn btn-success" onclick="openPopup()">æ‰“å¼€æ’ä»¶å¼¹çª—</button>
                </div>
                <div class="col-md-6">
                    <h5>Content Scriptæµ‹è¯•</h5>
                    <button class="btn btn-info" onclick="testContentScript()">æµ‹è¯•Content Script</button>
                    <button class="btn btn-warning" onclick="injectTestLinks()">æ³¨å…¥æµ‹è¯•é“¾æ¥</button>
                    <div id="contentScriptResults"></div>
                </div>
            </div>
        </div>
        
        <!-- ä¸‹è½½é“¾æ¥æµ‹è¯• -->
        <div class="demo-section">
            <h3>ğŸ“¥ ä¸‹è½½é“¾æ¥æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä»¥ä¸‹é“¾æ¥æµ‹è¯•æ’ä»¶æ˜¯å¦èƒ½æ­£ç¡®è¯†åˆ«å¹¶æ·»åŠ ä¸‹è½½æŒ‰é’®ï¼š</p>
            
            <div class="row">
                <div class="col-md-4">
                    <h6>å‹ç¼©æ–‡ä»¶</h6>
                    <a href="http://localhost:5000/static/test.zip" class="download-link">test.zip</a>
                    <a href="https://example.com/archive.rar" class="download-link">archive.rar</a>
                    <a href="https://example.com/data.7z" class="download-link">data.7z</a>
                </div>
                <div class="col-md-4">
                    <h6>æ–‡æ¡£æ–‡ä»¶</h6>
                    <a href="https://example.com/document.pdf" class="download-link">document.pdf</a>
                    <a href="https://example.com/report.docx" class="download-link">report.docx</a>
                    <a href="https://example.com/presentation.pptx" class="download-link">presentation.pptx</a>
                </div>
                <div class="col-md-4">
                    <h6>å¯æ‰§è¡Œæ–‡ä»¶</h6>
                    <a href="https://example.com/installer.exe" class="download-link">installer.exe</a>
                    <a href="https://example.com/app.dmg" class="download-link">app.dmg</a>
                    <a href="https://example.com/package.deb" class="download-link">package.deb</a>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-6">
                    <h6>åª’ä½“æ–‡ä»¶</h6>
                    <a href="https://example.com/video.mp4" class="download-link">video.mp4</a>
                    <a href="https://example.com/audio.mp3" class="download-link">audio.mp3</a>
                    <a href="https://example.com/image.iso" class="download-link">image.iso</a>
                </div>
                <div class="col-md-6">
                    <h6>ç‰¹æ®Šé“¾æ¥</h6>
                    <a href="https://example.com/download?file=test.zip" class="download-link">download?file=test.zip</a>
                    <a href="https://example.com/releases/download/v1.0/app.exe" class="download-link">releases/download/v1.0/app.exe</a>
                    <a href="https://example.com/files/attachment.pdf" class="download-link">files/attachment.pdf</a>
                </div>
            </div>
        </div>
        
        <!-- æœåŠ¡å™¨ç®¡ç†æµ‹è¯• -->
        <div class="demo-section">
            <h3>ğŸ–¥ï¸ æœåŠ¡å™¨ç®¡ç†æµ‹è¯•</h3>
            <div class="server-form">
                <h6>åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="serverName" class="form-label">æœåŠ¡å™¨åç§°</label>
                            <input type="text" class="form-control" id="serverName" value="æµ‹è¯•æœåŠ¡å™¨">
                        </div>
                        <div class="mb-3">
                            <label for="serverHost" class="form-label">ä¸»æœºåœ°å€</label>
                            <input type="text" class="form-control" id="serverHost" value="192.168.1.100">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="serverPort" class="form-label">ç«¯å£</label>
                            <input type="number" class="form-control" id="serverPort" value="22">
                        </div>
                        <div class="mb-3">
                            <label for="serverUsername" class="form-label">ç”¨æˆ·å</label>
                            <input type="text" class="form-control" id="serverUsername" value="testuser">
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="serverPassword" class="form-label">å¯†ç </label>
                    <input type="password" class="form-control" id="serverPassword" value="testpass">
                </div>
                <button class="btn btn-primary" onclick="createTestServer()">åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨</button>
                <button class="btn btn-secondary" onclick="listServers()">åˆ—å‡ºæ‰€æœ‰æœåŠ¡å™¨</button>
                <div id="serverResults"></div>
            </div>
        </div>
        
        <!-- æ—¥å¿—è¾“å‡º -->
        <div class="demo-section">
            <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h3>
            <div id="logOutput" style="background: #f8f9fa; padding: 1rem; border-radius: 0.25rem; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.875rem;">
                <div class="text-muted">ç­‰å¾…æµ‹è¯•ç»“æœ...</div>
            </div>
            <button class="btn btn-outline-secondary btn-sm mt-2" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <script type="module">
        // å¯¼å…¥APIå®¢æˆ·ç«¯
        import ApiClient from '/static/api-client.js';
        const apiClient = new ApiClient();
        window.apiClient = apiClient;
        window.testResults = [];
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `test-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result test-${type}`;
            resultDiv.textContent = message;
            container.appendChild(resultDiv);
            
            // é™åˆ¶ç»“æœæ•°é‡
            const results = container.querySelectorAll('.test-result');
            if (results.length > 5) {
                results[0].remove();
            }
        }
        
        // APIæµ‹è¯•å‡½æ•°
        window.testHealthCheck = async function() {
            try {
                log('å¼€å§‹å¥åº·æ£€æŸ¥...', 'info');
                const result = await apiClient.healthCheck();
                log(`å¥åº·æ£€æŸ¥æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
                showResult('apiResults', `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${result.status}`, 'success');
            } catch (error) {
                log(`å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                showResult('apiResults', `âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        window.testGetServers = async function() {
            try {
                log('è·å–æœåŠ¡å™¨åˆ—è¡¨...', 'info');
                const servers = await apiClient.getServers();
                log(`è·å–æœåŠ¡å™¨åˆ—è¡¨æˆåŠŸ: ${servers.length} ä¸ªæœåŠ¡å™¨`, 'success');
                showResult('apiResults', `âœ… è·å–æœåŠ¡å™¨åˆ—è¡¨æˆåŠŸ: ${servers.length} ä¸ªæœåŠ¡å™¨`, 'success');
            } catch (error) {
                log(`è·å–æœåŠ¡å™¨åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
                showResult('apiResults', `âŒ è·å–æœåŠ¡å™¨åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        window.testCreateServer = async function() {
            try {
                log('åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨...', 'info');
                const testServer = {
                    name: 'Demoæµ‹è¯•æœåŠ¡å™¨',
                    host: 'demo.example.com',
                    port: 22,
                    username: 'demo',
                    password: 'demo123',
                    defaultPath: '/home/demo/'
                };
                
                const backendData = apiClient.convertFrontendToBackend(testServer);
                const result = await apiClient.createServer(backendData);
                log(`åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
                showResult('apiResults', `âœ… åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨æˆåŠŸ`, 'success');
            } catch (error) {
                log(`åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨å¤±è´¥: ${error.message}`, 'error');
                showResult('apiResults', `âŒ åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        window.testApiClient = async function() {
            try {
                log('æµ‹è¯•APIå®¢æˆ·ç«¯...', 'info');
                
                // æµ‹è¯•åŸºç¡€æ–¹æ³•
                const health = await apiClient.healthCheck();
                log('âœ… å¥åº·æ£€æŸ¥é€šè¿‡', 'success');
                
                const servers = await apiClient.getServers();
                log(`âœ… è·å–æœåŠ¡å™¨åˆ—è¡¨é€šè¿‡: ${servers.length} ä¸ª`, 'success');
                
                showResult('clientResults', `âœ… APIå®¢æˆ·ç«¯æµ‹è¯•é€šè¿‡`, 'success');
            } catch (error) {
                log(`APIå®¢æˆ·ç«¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showResult('clientResults', `âŒ APIå®¢æˆ·ç«¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        window.testDataConversion = function() {
            try {
                log('æµ‹è¯•æ•°æ®è½¬æ¢...', 'info');
                
                // æµ‹è¯•å‰ç«¯åˆ°åç«¯è½¬æ¢
                const frontendServer = {
                    name: 'æµ‹è¯•æœåŠ¡å™¨',
                    host: 'test.example.com',
                    port: 22,
                    username: 'test',
                    password: 'test123',
                    defaultPath: '/home/test/'
                };
                
                const backendServer = apiClient.convertFrontendToBackend(frontendServer);
                log('âœ… å‰ç«¯åˆ°åç«¯è½¬æ¢é€šè¿‡', 'success');
                
                // æµ‹è¯•åç«¯åˆ°å‰ç«¯è½¬æ¢
                const convertedBackendServer = {
                    id: 'test-id',
                    name: 'æµ‹è¯•æœåŠ¡å™¨',
                    host: 'test.example.com',
                    port: 22,
                    protocol: 'SFTP',
                    username: 'test',
                    password: 'test123',
                    default_path: '/home/test/',
                    created_at: '2024-01-01T00:00:00Z',
                    updated_at: '2024-01-01T00:00:00Z'
                };
                
                const frontendServer2 = apiClient.convertBackendToFrontend(convertedBackendServer);
                log('âœ… åç«¯åˆ°å‰ç«¯è½¬æ¢é€šè¿‡', 'success');
                
                showResult('clientResults', `âœ… æ•°æ®è½¬æ¢æµ‹è¯•é€šè¿‡`, 'success');
            } catch (error) {
                log(`æ•°æ®è½¬æ¢æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showResult('clientResults', `âŒ æ•°æ®è½¬æ¢æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        // æ’ä»¶æµ‹è¯•å‡½æ•°
        window.checkPluginStatus = function() {
            log('æ£€æŸ¥æ’ä»¶çŠ¶æ€...', 'info');
            
            const statusDiv = document.getElementById('pluginStatus');
            
            // æ£€æŸ¥Chromeæ‰©å±•APIæ˜¯å¦å¯ç”¨
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                statusDiv.className = 'plugin-status plugin-active';
                statusDiv.textContent = 'âœ… æ’ä»¶å·²å®‰è£…å¹¶æ¿€æ´»';
                log('âœ… æ’ä»¶å·²å®‰è£…å¹¶æ¿€æ´»', 'success');
            } else {
                statusDiv.className = 'plugin-status plugin-inactive';
                statusDiv.textContent = 'âŒ æ’ä»¶æœªå®‰è£…æˆ–æœªæ¿€æ´»';
                log('âŒ æ’ä»¶æœªå®‰è£…æˆ–æœªæ¿€æ´»', 'error');
            }
        };
        
        window.openPopup = function() {
            log('å°è¯•æ‰“å¼€æ’ä»¶å¼¹çª—...', 'info');
            
            if (typeof chrome !== 'undefined' && chrome.action) {
                chrome.action.openPopup();
                log('âœ… æ’ä»¶å¼¹çª—å·²æ‰“å¼€', 'success');
            } else {
                log('âŒ æ— æ³•æ‰“å¼€æ’ä»¶å¼¹çª—', 'error');
            }
        };
        
        window.testContentScript = function() {
            log('æµ‹è¯•Content Script...', 'info');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¸‹è½½æŒ‰é’®è¢«æ³¨å…¥
            const downloadButtons = document.querySelectorAll('[data-easy-translate-download]');
            if (downloadButtons.length > 0) {
                log(`âœ… Content Scriptæ­£å¸¸å·¥ä½œï¼Œå‘ç° ${downloadButtons.length} ä¸ªä¸‹è½½æŒ‰é’®`, 'success');
                showResult('contentScriptResults', `âœ… Content Scriptæ­£å¸¸: ${downloadButtons.length} ä¸ªä¸‹è½½æŒ‰é’®`, 'success');
            } else {
                log('âŒ æœªå‘ç°ä¸‹è½½æŒ‰é’®ï¼ŒContent Scriptå¯èƒ½æœªæ­£å¸¸å·¥ä½œ', 'error');
                showResult('contentScriptResults', 'âŒ Content Scriptæœªæ­£å¸¸å·¥ä½œ', 'error');
            }
        };
        
        window.injectTestLinks = function() {
            log('æ³¨å…¥æµ‹è¯•é“¾æ¥...', 'info');
            
            // åˆ›å»ºä¸€äº›æµ‹è¯•é“¾æ¥
            const testLinks = [
                { url: 'https://example.com/test1.zip', text: 'æµ‹è¯•æ–‡ä»¶1.zip' },
                { url: 'https://example.com/test2.pdf', text: 'æµ‹è¯•æ–‡ä»¶2.pdf' },
                { url: 'https://example.com/test3.exe', text: 'æµ‹è¯•æ–‡ä»¶3.exe' }
            ];
            
            const container = document.createElement('div');
            container.innerHTML = '<h6>åŠ¨æ€æ³¨å…¥çš„æµ‹è¯•é“¾æ¥:</h6>';
            
            testLinks.forEach(link => {
                const a = document.createElement('a');
                a.href = link.url;
                a.textContent = link.text;
                a.className = 'download-link';
                container.appendChild(a);
            });
            
            document.querySelector('.demo-section:nth-child(3)').appendChild(container);
            log('âœ… æµ‹è¯•é“¾æ¥å·²æ³¨å…¥', 'success');
        };
        
        // æœåŠ¡å™¨ç®¡ç†æµ‹è¯•å‡½æ•°
        window.createTestServer = async function() {
            try {
                const serverData = {
                    name: document.getElementById('serverName').value,
                    host: document.getElementById('serverHost').value,
                    port: parseInt(document.getElementById('serverPort').value),
                    username: document.getElementById('serverUsername').value,
                    password: document.getElementById('serverPassword').value,
                    defaultPath: '/home/uploads/'
                };
                
                log('åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨...', 'info');
                const backendData = apiClient.convertFrontendToBackend(serverData);
                const result = await apiClient.createServer(backendData);
                
                log(`âœ… æµ‹è¯•æœåŠ¡å™¨åˆ›å»ºæˆåŠŸ: ${result.id}`, 'success');
                showResult('serverResults', `âœ… æœåŠ¡å™¨åˆ›å»ºæˆåŠŸ: ${serverData.name}`, 'success');
            } catch (error) {
                let detail = error.message;
                // å…¼å®¹ fetch/axios/Response
                if (error.response && typeof error.response.json === 'function') {
                    try {
                        const data = await error.response.json();
                        if (data && data.error) {
                            detail = data.error;
                        }
                    } catch (e) {}
                }
                if (error instanceof Response) {
                    try {
                        const data = await error.json();
                        if (data && data.error) {
                            detail = data.error;
                        }
                    } catch (e) {}
                }
                log(`âŒ åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨å¤±è´¥: ${detail}`, 'error');
                showResult('serverResults', `âŒ åˆ›å»ºå¤±è´¥: ${detail}`, 'error');
            }
        };
        
        window.listServers = async function() {
            try {
                log('è·å–æœåŠ¡å™¨åˆ—è¡¨...', 'info');
                const servers = await apiClient.getServers();
                
                if (servers.length === 0) {
                    log('ğŸ“‹ æœåŠ¡å™¨åˆ—è¡¨ä¸ºç©º', 'info');
                    showResult('serverResults', 'ğŸ“‹ æœåŠ¡å™¨åˆ—è¡¨ä¸ºç©º', 'info');
                } else {
                    log(`ğŸ“‹ æ‰¾åˆ° ${servers.length} ä¸ªæœåŠ¡å™¨:`, 'info');
                    servers.forEach(server => {
                        log(`  - ${server.name} (${server.host}:${server.port})`, 'info');
                    });
                    showResult('serverResults', `ğŸ“‹ æ‰¾åˆ° ${servers.length} ä¸ªæœåŠ¡å™¨`, 'info');
                }
            } catch (error) {
                log(`âŒ è·å–æœåŠ¡å™¨åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
                showResult('serverResults', `âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
            }
        };
        
        window.clearLog = function() {
            document.getElementById('logOutput').innerHTML = '<div class="text-muted">æ—¥å¿—å·²æ¸…ç©º...</div>';
        };
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ’ä»¶çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            log('Demoé¡µé¢å·²åŠ è½½', 'info');
            setTimeout(checkPluginStatus, 1000);
        });
        
        // ç›‘å¬æ¥è‡ªæ’ä»¶çš„æ¶ˆæ¯
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
                log(`æ”¶åˆ°æ’ä»¶æ¶ˆæ¯: ${JSON.stringify(message)}`, 'info');
                sendResponse({ received: true });
            });
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 